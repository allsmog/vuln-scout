# Swift Dangerous Functions

## Overview

Swift is primarily used for iOS, macOS, and server-side applications. This guide covers iOS/macOS security concerns and server-side Swift frameworks like Vapor.

---

## Command/Process Running

| Function/Class | Risk | Notes |
|----------------|------|-------|
| `Process()` | Critical | Run external commands |
| `NSTask` | Critical | Legacy process API |

**Grep Patterns:**
```bash
grep -rniE "(Process\(\)|NSTask|\.launchPath|\.arguments)" --include="*.swift"
```

**Vulnerable Pattern:**
```swift
// VULNERABLE - User input in command
func runCmd(_ userInput: String) -> String {
    let process = Process()
    process.launchPath = "/bin/sh"
    process.arguments = ["-c", userInput]  // Injection risk!
    // ...
}
```

---

## SQL/Database

### SQLite

| Pattern | Risk | Notes |
|---------|------|-------|
| String interpolation in SQL | Critical | SQL injection |
| FMDB with format strings | High | Check for interpolation |

**Grep Patterns:**
```bash
grep -rniE '(SELECT|INSERT|UPDATE|DELETE).*\\(' --include="*.swift"
grep -rniE "(sqlite3_prepare|executeQuery|executeUpdate)" --include="*.swift"
```

**Vulnerable Pattern:**
```swift
// VULNERABLE - String interpolation
let query = "SELECT * FROM users WHERE id = '\(id)'"

// SECURE - Parameterized query
db.executeQuery("SELECT * FROM users WHERE id = ?", values: [id])
```

### Core Data Predicates

```swift
// VULNERABLE - Format string injection
let predicate = NSPredicate(format: "name == '\(userInput)'")

// SECURE - Use argument substitution
let predicate = NSPredicate(format: "name == %@", userInput)
```

---

## File Operations

| Function | Risk | Notes |
|----------|------|-------|
| `FileManager` | Medium | File operations |
| `Data(contentsOf:)` | Medium | File read |
| `write(to:)` | High | File write |

**Grep Patterns:**
```bash
grep -rniE "(FileManager|contentsOf|contentsOfFile|write\(to:)" --include="*.swift"
```

**Path Traversal Prevention:**
```swift
func readFile(_ filename: String) -> String? {
    let baseURL = URL(fileURLWithPath: "/documents")
    let fileURL = baseURL.appendingPathComponent(filename).standardized
    guard fileURL.path.hasPrefix(baseURL.path) else { return nil }
    return try? String(contentsOf: fileURL)
}
```

---

## iOS-Specific

### WebView

| Pattern | Risk | Notes |
|---------|------|-------|
| `UIWebView` | Critical | Deprecated, insecure |
| `WKWebView` | Medium | Newer, but still risks |
| `loadHTMLString` | High | XSS if user content |
| `evaluateJavaScript` | High | JS injection |

**Grep Patterns:**
```bash
grep -rniE "(UIWebView|WKWebView)" --include="*.swift"
grep -rniE "(evaluateJavaScript|loadHTMLString)" --include="*.swift"
```

### Keychain

```bash
grep -rniE "(SecItemAdd|SecItemCopyMatching|kSecAttr)" --include="*.swift"
grep -rniE "kSecAttrAccessibleAlways" --include="*.swift"  # Insecure!
```

### URL Schemes

```bash
grep -rniE "(application.*open.*url|openURL)" --include="*.swift"
```

---

## HTTP/Network

| Library | Risk | Notes |
|---------|------|-------|
| `URLSession` | High | If URL user-controlled |
| `Alamofire` | High | HTTP client |

**Grep Patterns:**
```bash
grep -rniE "(URLSession|URLRequest|dataTask)" --include="*.swift"
grep -rniE 'URL\(string:.*\\(' --include="*.swift"
```

### App Transport Security

```bash
grep -rniE "NSAllowsArbitraryLoads" --include="Info.plist"
```

---

## Cryptography

| Pattern | Risk | Notes |
|---------|------|-------|
| Hardcoded keys | Critical | Embedded secrets |
| `CC_MD5` / `CC_SHA1` | High | Weak algorithms |
| `kCCAlgorithmDES` | Critical | Weak cipher |

**Grep Patterns:**
```bash
grep -rniE '(secret|key|password|apiKey)\s*[=:]\s*"' --include="*.swift"
grep -rniE "(CC_MD5|CC_SHA1|kCCAlgorithmDES)" --include="*.swift"
```

---

## Deserialization

| Class/Function | Risk | Notes |
|----------------|------|-------|
| `NSKeyedUnarchiver` | High | Objective-C serialization |
| `JSONDecoder` | Low | Generally safe |
| `Codable` | Low | Swift native, safe |

**Grep Patterns:**
```bash
grep -rniE "(NSKeyedUnarchiver|unarchiveObject)" --include="*.swift"
```

---

## Unsafe Swift

| Pattern | Risk | Notes |
|---------|------|-------|
| `UnsafePointer` | High | Raw pointer access |
| `UnsafeMutablePointer` | High | Mutable raw pointer |
| `Unmanaged` | High | Manual memory management |

**Grep Patterns:**
```bash
grep -rniE "(UnsafePointer|UnsafeMutablePointer|Unmanaged)" --include="*.swift"
```

---

## Testing Checklist

### iOS/macOS
1. [ ] Review Keychain accessibility settings
2. [ ] Check WebView configuration
3. [ ] Audit URL scheme handlers
4. [ ] Review App Transport Security exceptions
5. [ ] Check for certificate pinning

### General
1. [ ] Search for hardcoded credentials
2. [ ] Review cryptographic implementations
3. [ ] Check deserialization of untrusted data
4. [ ] Audit logging for sensitive data
5. [ ] Review unsafe pointer usage
