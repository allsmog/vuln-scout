---
name: session-init
description: Initialize whitebox pentest session and check for previous state
event: SessionStart
---

# Whitebox Pentest Session Initialization

On session start, check for existing audit state and provide context.

## State Detection

Check for existing audit state file at `.claude/whitebox-pentest.local.md`.

### If state file exists:

```
üîí **Whitebox Pentest Session Resumed**

Previous audit session detected:
- **Target**: [From state file]
- **Phase**: [Current phase from state]
- **Findings**: [Count of identified findings]
- **Last Activity**: [Timestamp]

**Quick Actions:**
- `/whitebox-pentest:full-audit` - Continue from current phase
- `/whitebox-pentest:report` - Generate report of findings so far
- Type "reset audit" to start fresh

**Pending Items:**
[List from state file]
```

### If no state file exists:

First, **check codebase size**:

```bash
# Quick file count
find . -type f \( -name "*.ts" -o -name "*.js" -o -name "*.py" -o -name "*.java" -o -name "*.go" -o -name "*.php" \) 2>/dev/null | wc -l
```

**If > 500 files**, check for monorepo:
```bash
ls package.json pnpm-workspace.yaml turbo.json nx.json go.work Cargo.toml pom.xml 2>/dev/null | head -1
```

**If monorepo detected**, show enhanced welcome:
```
üîí **Whitebox Pentest Plugin Ready**

üì¶ **Large Codebase Detected** - [N] source files
   Monorepo type: [npm workspaces / turborepo / go / maven / etc.]

**Recommended Workflow for Large Codebases:**
1. `/whitebox-pentest:scope --list` - List available packages
2. `/whitebox-pentest:scope <path>` - Create focused analysis scope
3. `/whitebox-pentest:full-audit --workspace <name>` - Audit specific package

**Or start full audit**:
- `/whitebox-pentest:full-audit` - Audit entire codebase
```

**Check for existing scope files**:
```bash
ls .claude/scope-*.md 2>/dev/null
```

If scopes exist, show them:
```
üìÅ **Existing Scopes Found:**
- scope-api.md
- scope-worker.md

Use with: `/whitebox-pentest:full-audit --scope api`
```

**Standard welcome (small codebase)**:
```
üîí **Whitebox Pentest Plugin Ready**

Available commands:
- `/whitebox-pentest:full-audit` - Start guided security audit
- `/whitebox-pentest:sinks [language]` - Quick dangerous function search
- `/whitebox-pentest:trace <function>` - Trace data flow to sink
- `/whitebox-pentest:sinks --discover` - Find logging/credential patterns

**Methodology:** HTB Academy / OffSec AWAE 4-Phase Process
1. Code Review ‚Üí 2. Local Testing ‚Üí 3. PoC Development ‚Üí 4. Patching

Type `/whitebox-pentest:full-audit` to begin a structured security assessment.
```

## State File Format

The `.claude/whitebox-pentest.local.md` file structure:

```markdown
---
target: Application Name
language: python
current_phase: 2
started: 2024-01-15T10:30:00Z
last_updated: 2024-01-15T14:45:00Z
---

# Whitebox Audit State

## Current Phase: Local Testing (Phase 2)

## Findings Summary
- Critical: 2
- High: 3
- Medium: 5
- Low: 2

## Detailed Findings

### Finding 1: SQL Injection in user_lookup()
- **Severity**: Critical
- **Location**: app/models/user.py:142
- **Status**: Confirmed
- **Phase 2 Notes**: Exploitable via user_id parameter

### Finding 2: Command Injection in export_report()
- **Severity**: Critical
- **Location**: app/utils/export.py:87
- **Status**: Testing in progress

## Next Steps
- [ ] Complete testing of Finding 2
- [ ] Develop PoC for Finding 1
- [ ] Trace data flow for medium findings
```
